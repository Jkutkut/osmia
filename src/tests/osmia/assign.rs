use super::*;

macro_tests!(
	test,
	(
		assign01,
		Some("{{assign v = 1 }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_number("1"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "1"
		// r#"{"v": 2}"#,
		// "1"
	),
	(
		assign_string,
		Some("{{assign v = \"foo\" }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_str("foo"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "foo"
	),
	(
		assign_int,
		Some("{{assign v = 1 }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_number("1"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "1"
	),
	(
		assign_float,
		Some("{{assign v = 1.1 }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_number("1.1"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "1.1"
	),
	(
		assign_bool,
		Some("{{assign v = true }}{{ v }} -- {{assign v = false }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::Bool(true),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::new_raw(" -- "),
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::Bool(false),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "true -- false"
	),
	(
		assign_null,
		Some("{{assign v = null }}{{ v }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::Null,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{}"#,
		// "null"
	),
	(
		assign_array_item,
		Some("{{assign v[2] = 2 }}{{ v[0] }}{{ v[1] }}{{ v[2] }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("2"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_number("2"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("0"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("1"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("2"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{"v": [1, 2,  3]}"#,
		// "122"
	),
	(
		assign_override01,
		Some("{{assign v = 1 }}{{v}}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_number("1"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::new_alpha("v"),
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{"v": {}}"#,
		// "1"
		// r#"{"v": [123, 2,  3]}"#,
		// "1"
	),
	(
		assign_variable01,
		Some("{{assign foo = bar }}{{foo}}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("foo"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_alpha("bar"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::new_alpha("foo"),
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{"bar": 2}"#,
		// "2"
	),
	(
		assign_variable02,
		Some("{{assign foo = bar * foo }}{{foo}}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("foo"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_alpha("bar"),
			Token::Whitespace,
			Token::Mult,
			Token::Whitespace,
			Token::new_alpha("foo"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::new_alpha("foo"),
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// r#"{"bar": 2, "foo": 2}"#,
		// "4"
	),
	(
		assign_array01,
		Some("{{assign v = [1,  2,  3] }}{{ v[0] }}{{ v[1] }}{{ v[2] }}"),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::ArrayStart,
			Token::new_number("1"),
			Token::Comma,
			Token::Whitespace,
			Token::new_number("2"),
			Token::Comma,
			Token::Whitespace,
			Token::new_number("3"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("0"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("1"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("2"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// "{}",
		// "123"
	),
	(
		assign_array02,
		Some(r#"{{assign v = [{"name": "foo"},  "this",  [3]]}}{{ v[0].name }} -- {{ v[1] }} -- {{ v[2][0] }}"#),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::ArrayStart,
			Token::ObjectStart,
			Token::new_str("name"),
			Token::Colon,
			Token::Whitespace,
			Token::new_str("foo"),
			Token::ObjectEnd,
			Token::Comma,
			Token::Whitespace,
			Token::new_str("this"),
			Token::Comma,
			Token::Whitespace,
			Token::ArrayStart,
			Token::new_number("3"),
			Token::ArrayEnd,
			Token::ArrayEnd,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("0"),
			Token::ArrayEnd,
			Token::Dot,
			Token::new_alpha("name"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::new_raw(" -- "),
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("1"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::new_raw(" -- "),
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::ArrayStart,
			Token::new_number("2"),
			Token::ArrayEnd,
			Token::ArrayStart,
			Token::new_number("0"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// "{}",
		// "foo -- this -- 3"
	),
	(
		assign_object01,
		Some(r#"{{assign v = {"foo": 1,  "bar": 2} }}{{ v.foo }} -- {{ v.bar }}"#),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::ObjectStart,
			Token::new_str("foo"),
			Token::Colon,
			Token::Whitespace,
			Token::new_number("1"),
			Token::Comma,
			Token::Whitespace,
			Token::new_str("bar"),
			Token::Colon,
			Token::Whitespace,
			Token::new_number("2"),
			Token::ObjectEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Dot,
			Token::new_alpha("foo"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::new_raw(" -- "),
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Dot,
			Token::new_alpha("bar"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// "{}",
		// "1 -- 2"
	),
	(
		assign_object02,
		Some(r#"{{assign v = {"foo": {"bar": 1},  "bar": [2]} }}{{ v.foo.bar }} -- {{ v.bar[0] }}"#),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::ObjectStart,
			Token::new_str("foo"),
			Token::Colon,
			Token::Whitespace,
			Token::ObjectStart,
			Token::new_str("bar"),
			Token::Colon,
			Token::Whitespace,
			Token::new_number("1"),
			Token::ObjectEnd,
			Token::Comma,
			Token::Whitespace,
			Token::new_str("bar"),
			Token::Colon,
			Token::Whitespace,
			Token::ArrayStart,
			Token::new_number("2"),
			Token::ArrayEnd,
			Token::ObjectEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Dot,
			Token::new_alpha("foo"),
			Token::Dot,
			Token::new_alpha("bar"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::new_raw(" -- "),
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("v"),
			Token::Dot,
			Token::new_alpha("bar"),
			Token::ArrayStart,
			Token::new_number("0"),
			Token::ArrayEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// "{}",
		// "1 -- 2"
	),
	(
		assign_object03,
		Some(r#"{{assign obj = {"user": {"name": "Marvin"} } }}{{assign obj.user.name = "R2D2" }}{{ obj.user.name }}"#),
		Some(vec![
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("obj"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::ObjectStart,
			Token::new_str("user"),
			Token::Colon,
			Token::Whitespace,
			Token::ObjectStart,
			Token::new_str("name"),
			Token::Colon,
			Token::Whitespace,
			Token::new_str("Marvin"),
			Token::ObjectEnd,
			Token::Whitespace,
			Token::ObjectEnd,
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Assign,
			Token::Whitespace,
			Token::new_alpha("obj"),
			Token::Dot,
			Token::new_alpha("user"),
			Token::Dot,
			Token::new_alpha("name"),
			Token::Whitespace,
			Token::AssignEq,
			Token::Whitespace,
			Token::new_str("R2D2"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::StmtStart,
			Token::Whitespace,
			Token::new_alpha("obj"),
			Token::Dot,
			Token::new_alpha("user"),
			Token::Dot,
			Token::new_alpha("name"),
			Token::Whitespace,
			Token::StmtEnd,
			Token::Eof
		]),
		None,
		None
		// "{}",
		// "R2D2"
	)
);
